version: '3.2'

networks:
  microservices-pattern_default:
    external: true

services:
  customer:
    build:
      context: .
      dockerfile: ./services/customer/Dockerfile
      target: builder
    command: >
      ash -c
      "GO111MODULE=off go get github.com/cespare/reflex &&
      reflex -c /work/reflex.conf"
    ports:
      - "127.0.0.1:50051:8080"
    volumes:
      - "./services/customer/reflex.conf:/work/reflex.conf"
      - ".:/work"
    container_name: customer_app
    networks:
      - microservices-pattern_default
  authority:
    build:
      context: .
      dockerfile: ./services/authority/Dockerfile
      target: builder
    command: >
      ash -c
      "GO111MODULE=off go get github.com/cespare/reflex &&
      reflex -c /work/reflex.conf"
    ports:
      - "127.0.0.1:50052:8080"
    volumes:
      - "./services/authority/reflex.conf:/work/reflex.conf"
      - ".:/work"
    container_name: authority_app
    networks:
      - microservices-pattern_default
  gateway:
    build:
      context: .
      dockerfile: ./services/gateway/Dockerfile
      target: builder
    command: >
      ash -c
      "GO111MODULE=off go get github.com/cespare/reflex &&
      reflex -c /work/reflex.conf"
    ports:
      - "127.0.0.1:50053:8080"
    volumes:
      - "./services/gateway/reflex.conf:/work/reflex.conf"
      - ".:/work"
    container_name: gateway_app
    networks:
      - microservices-pattern_default
  catalog:
    build:
      context: .
      dockerfile: ./services/catalog/Dockerfile
      target: builder
    command: >
      ash -c
      "GO111MODULE=off go get github.com/cespare/reflex &&
      reflex -c /work/reflex.conf"
    ports:
      - "127.0.0.1:50054:8080"
    volumes:
      - "./services/catalog/reflex.conf:/work/reflex.conf"
      - ".:/work"
    container_name: catalog_app
    networks:
      - microservices-pattern_default
  item:
    build:
      context: .
      dockerfile: ./services/item/Dockerfile
      target: builder
    command: >
      ash -c
      "GO111MODULE=off go get github.com/cespare/reflex &&
      reflex -c /work/reflex.conf"
    ports:
      - "127.0.0.1:50055:8080"
    volumes:
      - "./services/item/reflex.conf:/work/reflex.conf"
      - ".:/work"
    container_name: item_app
    networks:
      - microservices-pattern_default
